<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>

    <script src="js/jquery-2.1.1.js"></script>
    <script src="js/knockout-3.2.0.js"></script>

    <script src="kontraktor.js"></script>
    <script src="minbin.js"></script>
</head>
<body>

<b>Call Actor Rest Get</b>
<pre>
$.getJSON('rest/$authenticate/user/password', function (data) {
    model.restGetResult(JSON.stringify(data));
}).error(function(e) {
    model.restGetResult('error '+e);
});
</pre>

<b>Result:</b>
<p data-bind="text: restGetResult"></p>
<b>Session res</b>
<p data-bind="text: restGetSession"></p>
<b>Creation</b>
<p data-bind="text: restSessionCreation"></p>
<script>
    var model = {
        restGetResult: ko.observable(''),
        restGetSession: ko.observable(''),
        restSessionCreation: ko.observable('')
    };
    ko.applyBindings(model);

//    $.getJSON('rest/$authenticate/user/password', function (data) {
//        model.restGetResult(JSON.stringify(data));
//    }).error(function(e) {
//        model.restGetResult('error '+e);
//    });

//    var xhr = new XMLHttpRequest();
//    xhr.onload = function (e) {
//        if (xhr.readyState === 4) {
//            if (xhr.status === 200) {
//                model.restGetResult(xhr.responseText);
//            } else {
//                model.restGetResult('error '+xhr.statusText);
//            }
//        }
//    };
//    xhr.onerror = function (e) {
//        model.restGetResult('error '+xhr.statusText);
//    };
//    xhr.open( "GET", 'rest/$authenticate/user/password', true );
//    xhr.send( null );

    Kontraktor.restGET('$authenticate/user/password').then( function (sessionHandle,e) {
        if ( e == null ) {
            model.restGetResult(JSON.stringify(sessionHandle));
            Kontraktor.connectHome(function() {
                Kontraktor.call(1,'$getSession',true,[sessionHandle]).then( function(rsessionActorId,e) {
                    model.restGetSession(JSON.stringify(rsessionActorId));
                    Kontraktor.call(rsessionActorId, "$getCreationTime", true, []).then( function(r,e) {
                        model.restSessionCreation(r);
                    });
                });
            });
        } else {
            console.log(typeof e);
            model.restGetResult("res:"+sessionActorId+" error:"+e);
        }
    });

</script>


</body>
</html>